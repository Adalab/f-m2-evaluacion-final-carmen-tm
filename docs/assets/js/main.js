"use strict";const inputEl=document.querySelector(".app-input"),btnSearchEl=document.querySelector(".btn-search"),btnResetAllEl=document.querySelector(".btn-reset-all"),resultListEl=document.querySelector(".results__list"),favouritesListEl=document.querySelector(".favourites__list"),URL="http://api.tvmaze.com/search/shows?q=",DEFULT_IMAGE="https://via.placeholder.com/210x295/f4eded/9b1414/?text=",LS_FAVS_KEY="favShowsObjects";let resultsObjectsArr=[],favShowsObjectsArr=JSON.parse(localStorage.getItem(LS_FAVS_KEY))||[];function createLiOnDOM(t,e,s,r){const n=document.createElement("li");n.setAttribute("data-id",t);const o=document.createElement("img");o.classList.add("show-card__img"),o.setAttribute("src",s),o.setAttribute("alt",e);const a=document.createElement("h3");a.classList.add("show-card__title");const c=document.createTextNode(e);let l;if(a.appendChild(c),n.appendChild(o),n.appendChild(a),r){l=document.createElement("button");const e=document.createTextNode("x");l.appendChild(e),l.classList.add("btn-reset"),l.setAttribute("data-id",t),l.setAttribute("type","button"),l.setAttribute("title","Borra de favoritos"),n.appendChild(l)}else{l="";for(const e of favShowsObjectsArr)t===e.show.id&&n.classList.add("show-card--favourite")}return n}function appendClassAndTitle(t,e,s){return t.classList.add(e),t.setAttribute("title",s?"Show favorito":"Click para añadir este show a tu lista de favoritos"),t}function createItemsFromObjects(t,e,s){const r=[];for(const n of t){const{show:t}=n,{id:o,name:a,image:c}=t;let l="";const i=appendClassAndTitle(createLiOnDOM(o,a,l=c?c.medium:`${DEFULT_IMAGE}${a}`,s),e,s);r.push(i)}return r}function paintResults(t,e){e.innerHTML="";for(const s of t)e.appendChild(s)}function storeFavShowObjectInArr(t,e,s){for(const r of e)r.show.id===t&&s.push(r);return s}function storeFavObjectsOnLS(t,e){localStorage.setItem(t,JSON.stringify(e))}function drawFavourites(){if(paintResults(createItemsFromObjects(favShowsObjectsArr,"preview--favourite",!0),favouritesListEl),favShowsObjectsArr.length){const t=document.querySelectorAll(".btn-reset");for(const e of t)e.addEventListener("click",handlerBtnResetClick)}}function removeItemFromArray(t,e){for(let s=0;s<e.length;s++)e[s].show.id===parseInt(t)&&e.splice(s,1);storeFavObjectsOnLS(LS_FAVS_KEY,favShowsObjectsArr),drawFavourites()}function findAndUpdateClass(t,e,s,r){for(const n of e)if(n.show.id===parseInt(t)){const e=resultListEl.querySelector(`[data-id="${t}"]`);r?e.classList.add(s):e.classList.remove(s)}}function handlerBtnResetClick(t){const e=t.currentTarget.getAttribute("data-id");removeItemFromArray(e,favShowsObjectsArr),findAndUpdateClass(e,resultsObjectsArr,"show-card--favourite",!1)}function handlerAddToFavClick(t){const e=t.currentTarget,s=parseInt(e.getAttribute("data-id"));e.classList.toggle("show-card--favourite"),e.classList.contains("show-card--favourite")?(storeFavShowObjectInArr(s,resultsObjectsArr,favShowsObjectsArr),storeFavObjectsOnLS(LS_FAVS_KEY,favShowsObjectsArr),drawFavourites()):removeItemFromArray(s,favShowsObjectsArr)}function drawResults(t){paintResults(createItemsFromObjects(t,"show-card",!1),resultListEl);const e=document.querySelectorAll(".show-card");for(const t of e)t.addEventListener("click",handlerAddToFavClick)}function getShowsFromAPI(t){fetch(`${URL}${t}`).then(function(t){return t.json()}).then(function(e){resultsObjectsArr=e,e.length?drawResults(e):resultListEl.innerHTML=`\n        <p>Lo sentimos. No hay resultados para tu búsqueda "${t}". Inténtalo de nuevo con otro nombre :)</p>\n        `})}function handlerBtnSearchClick(t){t.preventDefault();const e=inputEl.value;e&&getShowsFromAPI(e)}function syncResults(){const t=resultListEl.querySelectorAll(".show-card");for(const e of t)e.classList.remove("show-card--favourite")}function handlerBtnResetAllClick(){favShowsObjectsArr=[],syncResults(),storeFavObjectsOnLS(LS_FAVS_KEY,favShowsObjectsArr),drawFavourites()}const initApp=()=>{drawFavourites(),btnSearchEl.addEventListener("click",handlerBtnSearchClick),btnResetAllEl.addEventListener("click",handlerBtnResetAllClick)};drawFavourites(),btnSearchEl.addEventListener("click",handlerBtnSearchClick),btnResetAllEl.addEventListener("click",handlerBtnResetAllClick);