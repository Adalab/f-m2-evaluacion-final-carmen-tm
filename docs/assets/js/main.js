"use strict";const inputEl=document.querySelector(".app-input"),btnEl=document.querySelector(".btn"),resultListEl=document.querySelector(".results__list"),favouritesListEl=document.querySelector(".favourites__list");let resultsArr=[],myFavShowsArr=[];const favShowsObjectsArray=[];function createItemsFromSearch(t){resultsArr=[];for(const e of t){const t=e.show.id,r=e.show.name;let s="";s=e.show.image?e.show.image.medium:`https://via.placeholder.com/210x295/f4eded/9b1414/?text=${r}`;const n=document.createElement("li"),o=document.createElement("img");o.setAttribute("src",s),o.setAttribute("alt",r);const c=document.createElement("h3"),a=document.createTextNode(r);c.appendChild(a),n.setAttribute("id",t),n.appendChild(o),n.appendChild(c),resultsArr.push(n)}return resultsArr}function appendClass(t,e){for(const r of t)r.classList.add(e),r.setAttribute("title","Añade a tu lista de favoritos");return t}function paintResults(t,e){e.innerHTML="";for(const r of t)e.appendChild(r)}function storeArrInObject(t){for(let e=0;e<t.length;e++){const r=t[e].firstElementChild,s=r.src,n=r.nextElementSibling.innerHTML,o=t[e].getAttribute("id");favShowsObjectsArray[e]={url:s,title:n,id:o}}}function createItemsFromObjArr(t){const e=[];for(const r of t){const t=r.title,s=r.url,n=r.id,o=document.createElement("li"),c=document.createElement("img");c.setAttribute("src",s),c.setAttribute("alt",t);const a=document.createElement("h3"),i=document.createTextNode(t);a.appendChild(i),o.appendChild(c),o.appendChild(a),o.setAttribute("id",n),o.classList.add("preview--favourite"),addResetBtn(n,o),e.push(o)}return e}function storeInLS(t,e){localStorage.setItem(t,JSON.stringify(e))}function refreshPage(){const t=JSON.parse(localStorage.getItem("myObject"));if(t){const e=createItemsFromObjArr(t);myFavShowsArr=e,paintResults(e,favouritesListEl)}else console.log("caché is empty")}function handlerResetBtnClick(t){const e=t.currentTarget.parentNode;favouritesListEl.removeChild(e)}function addResetBtn(t,e){const r=document.createElement("button");r.classList.add("reset-btn"),r.setAttribute("title","Borra de favoritos");const s=document.createTextNode("x");r.appendChild(s),r.setAttribute("data--id",t),e.appendChild(r),r.addEventListener("click",handlerResetBtnClick)}function handlerCardsFavClick(t){const e=t.currentTarget,r=e.id;for(const t of myFavShowsArr)if(r===t.id)return void t.classList.add("show-card--favourite");e.classList.add("show-card--favourite"),myFavShowsArr.push(e),storeArrInObject(myFavShowsArr),paintResults(createItemsFromObjArr(favShowsObjectsArray),favouritesListEl),storeInLS("myObject",favShowsObjectsArray)}function handlerBtnSearch(){const t=inputEl.value;fetch(`http://api.tvmaze.com/search/shows?q=${t}`).then(function(t){return t.json()}).then(function(t){return t}).then(function(t){paintResults(appendClass(createItemsFromSearch(t),"show-card"),resultListEl);const e=document.querySelectorAll(".show-card");for(const t of e)t.addEventListener("click",handlerCardsFavClick)})}btnEl.addEventListener("click",handlerBtnSearch),refreshPage();