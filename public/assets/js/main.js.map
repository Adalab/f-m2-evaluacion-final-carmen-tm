{"version":3,"sources":["main.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"main.js","sourcesContent":["/* eslint-disable no-console */\n'use strict';\n\n//ELEMENTS\nconst inputEl = document.querySelector('.app-input');\nconst btnEl = document.querySelector('.btn');\nconst resultListEl = document.querySelector('.results__list');\nconst favouritesListEl = document.querySelector('.favourites__list');\n\nconst URL = 'http://api.tvmaze.com/search/shows?q=';\nconst DEFULT_IMAGE = 'https://via.placeholder.com/210x295/f4eded/9b1414/?text=';\n\n//EMPTY ARRAYS/OBJECTS\n//Empty array for items results from search\nlet resultsArr = [];\n//Empty array for storing favourites shows\nlet myFavShowsArr = [];\n//Emtpy array of objects for paiting in favourit list and storing in LS\nconst favShowsObjectsArray = [];\n\n//FUNCTIONS\n//Create li items from the API result\nfunction createItemsFromSearch(array) {\n  //Reset array\n  resultsArr = [];\n\n  for (const element of array) {\n    // const idShow = element.show.id;\n    // const arrNames = element.show.name;\n    const { show } = element;\n    console.log(show);\n    const { id, name, image } = show;\n\n    let finalImage = '';\n    if (!image) {\n      finalImage = `${DEFULT_IMAGE}${name}`;\n    } else {\n      finalImage = image.medium;\n    }\n\n    //Create li elements\n    const newItemEl = document.createElement('li');\n\n    //Create content node\n    const contentItemImgEl = document.createElement('img');\n    contentItemImgEl.setAttribute('src', finalImage);\n    contentItemImgEl.setAttribute('alt', name);\n\n    const contentItemTitleEl = document.createElement('h3');\n    const contentItemTitleText = document.createTextNode(name);\n    contentItemTitleEl.appendChild(contentItemTitleText);\n\n    //Add id to make easier further instructions\n    newItemEl.setAttribute('id', id);\n\n    newItemEl.appendChild(contentItemImgEl);\n    newItemEl.appendChild(contentItemTitleEl);\n\n    //Fill empty array with all items:\n    resultsArr.push(newItemEl);\n  }\n\n  return resultsArr;\n}\n\n//Add a class to each item on a array\nfunction appendClass(arrayItems, myClass) {\n  for (const item of arrayItems) {\n    item.classList.add(myClass);\n    item.setAttribute('title', 'Añade a tu lista de favoritos');\n  }\n  return arrayItems;\n}\n\n//Append each li to its list\nfunction paintResults(array, list) {\n  // Reset list content\n  list.innerHTML = '';\n  for (const element of array) {\n    list.appendChild(element);\n  }\n}\n\nfunction storeArrInObject(array) {\n  for (let i = 0; i < array.length; i++) {\n    const favImgEl = array[i].firstElementChild;\n    const favImgUrl = favImgEl.src;\n\n    const favTitleEl = favImgEl.nextElementSibling;\n    const favTitleText = favTitleEl.innerHTML;\n\n    const favId = array[i].getAttribute('id');\n\n    favShowsObjectsArray[i] = {\n      url: favImgUrl,\n      title: favTitleText,\n      id: favId\n    };\n  }\n}\n\nfunction createItemsFromObjArr(array) {\n  const arrItemsToPaint = [];\n  for (const item of array) {\n    const name = item.title;\n    const url = item.url;\n    const id = item.id;\n\n    //Create elements and contents\n    const prevItemEl = document.createElement('li');\n\n    const prevItemImgEl = document.createElement('img');\n    prevItemImgEl.setAttribute('src', url);\n    prevItemImgEl.setAttribute('alt', name);\n\n    const prevItemTitleEl = document.createElement('h3');\n    const prevItemTitleContent = document.createTextNode(name);\n    prevItemTitleEl.appendChild(prevItemTitleContent);\n\n    //Append filled elements to my item\n    prevItemEl.appendChild(prevItemImgEl);\n    prevItemEl.appendChild(prevItemTitleEl);\n    prevItemEl.setAttribute('id', id);\n    prevItemEl.classList.add('preview--favourite');\n\n    //Add reset button to each item\n    addResetBtn(id, prevItemEl);\n\n    arrItemsToPaint.push(prevItemEl);\n  }\n  return arrItemsToPaint;\n}\n\nfunction storeInLS(key, array) {\n  localStorage.setItem(key, JSON.stringify(array));\n}\n\nfunction refreshPage() {\n  //Check if LS has something\n  const infoSavedInLS = JSON.parse(localStorage.getItem('myObject'));\n\n  if (infoSavedInLS) {\n    const savedItemToPaint = createItemsFromObjArr(infoSavedInLS);\n\n    myFavShowsArr = savedItemToPaint;\n\n    // Paint li on my favourist list\n    paintResults(savedItemToPaint, favouritesListEl);\n  } else {\n    console.log('caché is empty');\n  }\n}\n\nfunction handlerResetBtnClick(event) {\n  const resetBtnClicked = event.currentTarget;\n\n  const itemForRemove = resetBtnClicked.parentNode;\n\n  //Removing from the painted list\n  favouritesListEl.removeChild(itemForRemove);\n}\n\nfunction addResetBtn(id, myItem) {\n  //Create btn reset\n  const resetBtnEl = document.createElement('button');\n  resetBtnEl.classList.add('reset-btn');\n  resetBtnEl.setAttribute('title', 'Borra de favoritos');\n\n  const resetBtnContent = document.createTextNode('x');\n\n  resetBtnEl.appendChild(resetBtnContent);\n  resetBtnEl.setAttribute('data--id', id);\n\n  myItem.appendChild(resetBtnEl);\n\n  //Add listener\n  resetBtnEl.addEventListener('click', handlerResetBtnClick);\n}\n\n//Add favourite functionlity on click\nfunction handlerCardsFavClick(event) {\n  const selectedCard = event.currentTarget;\n  const idFav = selectedCard.id;\n  // console.log(idFav);\n  // console.log(myFavShowsArr);\n\n  for (const card of myFavShowsArr) {\n    //If element is already there, abort\n    if (idFav === card.id) {\n      card.classList.add('show-card--favourite');\n      return;\n    } else {\n      // console.log('id nuevo');\n    }\n  }\n  //Add a special class for favourites\n  selectedCard.classList.add('show-card--favourite');\n\n  //Store in my favArray empty array\n  myFavShowsArr.push(selectedCard);\n  // console.log(myFavShowsArr);\n\n  //Store my array of li in an object\n  storeArrInObject(myFavShowsArr);\n\n  //Create array of li filled with content from the array of objects we have\n  const newArrayItemsToPaint = createItemsFromObjArr(favShowsObjectsArray);\n\n  // Paint li on my favourist list\n  paintResults(newArrayItemsToPaint, favouritesListEl);\n\n  //Store my favShowsObjectsArray in LS\n  storeInLS('myObject', favShowsObjectsArray);\n}\n\n//FUNCTIONS\nfunction getShowsFromApi(query) {\n  fetch(`${URL}${query}`)\n    .then(function(response) {\n      return response.json();\n    })\n    .then(function(responseParsed) {\n      console.log(responseParsed);\n      //If there are no results... :(\n      if (!responseParsed.length) {\n        console.log('no hay resultados');\n        // FIXME:\n        resultListEl.innerHTML = `\n        <p>No hay resultados para la búsqueda: ${query}</p>\n        `;\n      }\n      //If there are results, keep going :)\n      return responseParsed;\n    })\n    .then(function(arrayShows) {\n      //FIRST Create li items from data\n      const myItems = createItemsFromSearch(arrayShows);\n\n      //SECOND add card class\n      const myItemsWithClass = appendClass(myItems, 'show-card');\n      //THIRD Paint li results\n      paintResults(myItemsWithClass, resultListEl);\n\n      // Add listener to each card from the results to add Favourites functionality\n      const resultsCardEl = document.querySelectorAll('.show-card');\n      for (const card of resultsCardEl) {\n        card.addEventListener('click', handlerCardsFavClick);\n      }\n    });\n}\n\n//Handler for main Search button\nfunction handlerBtnSearchClick(event) {\n  event.preventDefault();\n\n  const userValue = inputEl.value;\n  //Make API fetch just if the user has written on the input!\n  if (userValue) {\n    getShowsFromApi(userValue);\n  }\n}\n\n//Add lister to main Search button\nbtnEl.addEventListener('click', handlerBtnSearchClick);\n\n//Retrieve info from LS when refreshing\nrefreshPage();\n"]}