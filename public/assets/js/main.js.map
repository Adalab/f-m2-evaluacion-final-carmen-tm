{"version":3,"sources":["main.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"main.js","sourcesContent":["/* eslint-disable no-console */\n'use strict';\n\n//ELEMENTS\nconst inputEl = document.querySelector('.app-input');\nconst btnSearchEl = document.querySelector('.btn-search');\n\nconst resultListEl = document.querySelector('.results__list');\nconst favouritesListEl = document.querySelector('.favourites__list');\n\nconst URL = 'http://api.tvmaze.com/search/shows?q=';\nconst DEFULT_IMAGE = 'https://via.placeholder.com/210x295/f4eded/9b1414/?text=';\nconst LS_FAVS_KEY = 'favShowsObjects';\n\n//EMPTY ARRAYS of OBJECTS\n//Empty array for storing all the info from the result on any search\nlet resultsObjectsArr = [];\n//Always check if LS has something when starting/refreshing!! If not (falsy), give me an empty array\nlet favShowsObjectsArr = JSON.parse(localStorage.getItem(LS_FAVS_KEY)) || [];\n\n//FUNCTIONS\nfunction createLiOnDOM(id, name, image, isFav) {\n  const newItemEl = document.createElement('li');\n  newItemEl.setAttribute('data-id', id);\n\n  //Create content nodes\n  const itemImgEl = document.createElement('img');\n  itemImgEl.classList.add('show-card__img');\n  itemImgEl.setAttribute('src', image);\n  itemImgEl.setAttribute('alt', name);\n\n  const itemTitleEl = document.createElement('h3');\n  itemTitleEl.classList.add('show-card__title');\n  const itemTitleText = document.createTextNode(name);\n  itemTitleEl.appendChild(itemTitleText);\n\n  //Append elements\n  newItemEl.appendChild(itemImgEl);\n  newItemEl.appendChild(itemTitleEl);\n\n  let itemBtnResetEl;\n  if (isFav) {\n    itemBtnResetEl = document.createElement('button');\n    const itemBtnResetText = document.createTextNode('x');\n    itemBtnResetEl.appendChild(itemBtnResetText);\n    itemBtnResetEl.classList.add('btn-reset');\n    itemBtnResetEl.setAttribute('data-id', id);\n    itemBtnResetEl.setAttribute('title', 'Borra de favoritos');\n    newItemEl.appendChild(itemBtnResetEl);\n  } else {\n    itemBtnResetEl = '';\n  }\n\n  return newItemEl;\n}\n\n//Add a class to each item on a array\nfunction appendClassAndTitle(myElement, myClass, isFav) {\n  myElement.classList.add(myClass);\n  myElement.setAttribute(\n    'title',\n    isFav\n      ? 'Show favorito'\n      : 'Click para añadir este show a tu lista de favoritos'\n  );\n  return myElement;\n}\n\n//Create li items from Objects (the API result, my array of objects..)\nfunction createItemsFromObjects(array, myClass, isFav) {\n  const liArr = [];\n  for (const element of array) {\n    const { show } = element;\n    const { id, name, image } = show;\n\n    let finalImage = '';\n    if (!image) {\n      finalImage = `${DEFULT_IMAGE}${name}`;\n    } else {\n      finalImage = image.medium;\n    }\n\n    //Advanced DOM: Create <li> and append them to the DOM\n    const liOnDOM = createLiOnDOM(id, name, finalImage, isFav);\n\n    //Add class 'show-card' for visual styles\n    const liOnDOMWithClass = appendClassAndTitle(liOnDOM, myClass, isFav);\n    liArr.push(liOnDOMWithClass);\n  }\n  return liArr;\n}\n\n//Append each li to its list\nfunction paintResults(array, list) {\n  // Reset list content\n  list.innerHTML = '';\n  for (const element of array) {\n    list.appendChild(element);\n  }\n}\n\nfunction storeFavShowObjectInArr(id, array1, array2) {\n  for (const item of array1) {\n    if (item.show.id === id) {\n      array2.push(item);\n    }\n  }\n  return array2;\n}\n\n//Storing objects on LocalStore\nfunction storeFavObjectsOnLS(key, array) {\n  localStorage.setItem(key, JSON.stringify(array));\n}\n\nfunction drawFavourites() {\n  //Create li fav items from data\n  const myFavItems = createItemsFromObjects(\n    favShowsObjectsArr,\n    'preview--favourite',\n    true\n  );\n\n  //Paint li fav on the list fav\n  paintResults(myFavItems, favouritesListEl);\n\n  //Add listeners to btn-reset\n  if (favShowsObjectsArr.length) {\n    const btnResetEls = document.querySelectorAll('.btn-reset');\n    //Add listener to my reset buttons\n    for (const btnReset of btnResetEls) {\n      // console.log(btnResetEls);\n      btnReset.addEventListener('click', handlerBtnResetClick);\n    }\n  }\n}\n\nfunction removeItemFromArray(id, array) {\n  for (let i = 0; i < array.length; i++) {\n    if (array[i].show.id === parseInt(id)) {\n      console.log('item para borrar', id, array, i);\n      array.splice(i, 1);\n    }\n  }\n  //Store my array of fav objects in LS\n  storeFavObjectsOnLS(LS_FAVS_KEY, favShowsObjectsArr);\n  //Draw updated list of favourites\n  drawFavourites();\n}\n\nfunction handlerBtnResetClick(event) {\n  console.log('click');\n  const currentBtnReset = event.currentTarget;\n  const idBtnReset = currentBtnReset.getAttribute('data-id');\n\n  //Remove item from fav array\n  removeItemFromArray(idBtnReset, favShowsObjectsArr);\n}\n\n//Add favourite functionlity on click\nfunction handlerAddToFavClick(event) {\n  const currentCard = event.currentTarget;\n  const idFav = parseInt(currentCard.getAttribute('data-id'));\n  console.log(idFav);\n\n  currentCard.classList.toggle('show-card--favourite');\n\n  if (currentCard.classList.contains('show-card--favourite')) {\n    console.log(\n      'Recién favorita, añádeme al LS y píntame en la lista de Favoritos'\n    );\n    //Store my favourite show as an object in my fav objects array\n    storeFavShowObjectInArr(idFav, resultsObjectsArr, favShowsObjectsArr);\n\n    //Store my array of fav objects in LS\n    storeFavObjectsOnLS(LS_FAVS_KEY, favShowsObjectsArr);\n\n    //Create li and paint them\n    drawFavourites();\n  } else {\n    console.log(\n      'era favorita, pero ya no. Quítame de LS y bórrame de favoritos'\n    );\n    removeItemFromArray(idFav, favShowsObjectsArr);\n  }\n}\n\nfunction drawResults(responseParsed) {\n  //Create li items from data\n  const myItems = createItemsFromObjects(responseParsed, 'show-card', false);\n  //Paint li on the list results\n  paintResults(myItems, resultListEl);\n\n  //Implement 'Add to Favourites' new functionality\n  const resultsCardsEls = document.querySelectorAll('.show-card');\n  for (const card of resultsCardsEls) {\n    card.addEventListener('click', handlerAddToFavClick);\n  }\n}\n\nfunction getShowsFromAPI(query) {\n  fetch(`${URL}${query}`)\n    .then(function(response) {\n      return response.json();\n    })\n    .then(function(responseParsed) {\n      //On any search, I fill this empty array with the objects that come from the API, with ALL THE INFO of each show on it!!\n      resultsObjectsArr = responseParsed;\n\n      //If there are no results... :(\n      if (!responseParsed.length) {\n        resultListEl.innerHTML = `\n        <p>Lo sentimos. No hay resultados para tu búsqueda \"${query}\". Inténtalo de nuevo con otro nombre :)</p>\n        `;\n\n        //If there are results, keep going :)\n      } else {\n        drawResults(responseParsed);\n      }\n    });\n}\n\n//Handler for main Search button\nfunction handlerBtnSearchClick(event) {\n  event.preventDefault();\n\n  const userValue = inputEl.value;\n  //Make API fetch just if the user has written something\n  if (userValue) {\n    getShowsFromAPI(userValue);\n  }\n}\n\n//All the things taht happen when loading the page\n//Add lister to main Search button\nconst initApp = () => {\n  drawFavourites();\n  btnSearchEl.addEventListener('click', handlerBtnSearchClick);\n};\ninitApp();\n"]}